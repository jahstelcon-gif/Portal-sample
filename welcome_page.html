<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JAHS Telecon Portal</title>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <link rel="stylesheet" href="welcome_page.css">
</head>
<body>

  <!-- Navigation -->
  <nav>
    <button id="login">Login</button>
  </nav>

  <!-- Slider -->
  <div class="slider-container">
    <div class="slides">
      <img src="bg1.png" alt="Slide 1">
      <img src="bg2.png" alt="Slide 2">
      <img src="bg3.png" alt="Slide 3">
      <img src="bg4.png" alt="Slide 4">
    </div>

    <div class="right-card">
      <img src="logowebb.png" style="height: 130px;">
      <h1>Login</h1>
      <form id="universalLoginForm">
        <div class="input-group">
          <input type="email" id="login_email" placeholder=" " required>
          <label for="login_email">Email</label>
        </div>
        <div class="input-group">
          <input type="password" id="login_password" placeholder=" " required>
          <label for="login_password">Password</label>
          <span class="toggle-password" onclick="togglePassword()" style="color: white;">üëÅ</span>
        </div>
        <button type="submit">Sign In</button>
      </form>
      <img src="qrcode.png" style="height: 330px;">
    </div>

    <button class="center-button" id="join">Join our Team!</button>
  </div>

  <!-- Join Popup -->
  <div class="popup_overlay" id="pop_join">
    <div class="popup_box">
      <span class="close" id="closeJoin">&times;</span>
      <div class="popup_left">
        <iframe
          src="https://www.google.com/maps?q=14.8070035,120.8683621&hl=es;z=14&output=embed"
          allowfullscreen>
        </iframe>
      </div>
      <div class="popup_right">
        <h2>Join Our Team</h2>
        <form id="joinForm">
          <label for="join_email">Email:</label>
          <!-- üëá Email stays visible but now triggers Google login -->
          <input type="email" id="join_email" placeholder="Click to sign in with Google" required readonly style="cursor:pointer; background-color:#f9f9f9;">

          <label for="join_message">Message Us:</label>
          <textarea id="join_message" rows="4" required></textarea>
          <button type="submit">Submit</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Login Popup -->
  <div id="pop_login" class="popup_overlay">
    <div class="login_box">
      <span class="close" style="color: white;">&times;</span>
      <h2>Login</h2>
      <form id="universalLoginForm">
        <input type="email" id="login_email_popup" placeholder="Email" required><br><br>
        <div style="position:relative;">
          <input type="password" id="login_password_popup" placeholder="Password" required>
          <span class="toggle-password" onclick="togglePasswordPopup()">üëÅ</span>
        </div><br>
        <button type="submit">Sign In</button>
      </form>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- JS for Slider -->
  <script>
    const slides = document.querySelector('.slides');
    const slideCount = document.querySelectorAll('.slides img').length;
    let index = 0;

    function showNextSlide(interval) {
      setTimeout(function changeSlide() {
        index = (index + 1) % slideCount;
        slides.style.transform = `translateX(${-index * 100}%)`;
        const nextInterval = (index === 0) ? 6000 : 4000;
        showNextSlide(nextInterval);
      }, interval);
    }
    showNextSlide(6000);

    function togglePassword() {
      const pass = document.getElementById("login_password");
      pass.type = pass.type === "password" ? "text" : "password";
    }
    function togglePasswordPopup() {
      const pass = document.getElementById("login_password_popup");
      pass.type = pass.type === "password" ? "text" : "password";
    }
  </script>

  <!-- Firebase + Join Logic -->
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB1Gbmp2j2cTfnUmuWTjcL2ypauUpQn8Qc",
      authDomain: "jahsportal.firebaseapp.com",
      databaseURL: "https://jahsportal-default-rtdb.firebaseio.com",
      projectId: "jahsportal",
      storageBucket: "jahsportal.firebasestorage.app",
      messagingSenderId: "798312139932",
      appId: "1:798312139932:web:2f6654cdd82a23406ff159",
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    const googleProvider = new firebase.auth.GoogleAuthProvider();

    // Join Popup Controls
    const joinBtn = document.getElementById("join");
    const joinPopup = document.getElementById("pop_join");
    const closeJoin = document.getElementById("closeJoin");

    joinBtn.addEventListener("click", () => (joinPopup.style.display = "flex"));
    closeJoin.addEventListener("click", () => (joinPopup.style.display = "none"));
    window.addEventListener("click", (e) => {
      if (e.target === joinPopup) joinPopup.style.display = "none";
    });

    // EmailJS Init
    (function () {
      emailjs.init("I8tvyDhY29nbwRvAE"); // <-- Your EmailJS public key
    })();

    // Google Sign-in for Email Field
    const joinEmailInput = document.getElementById("join_email");
    joinEmailInput.addEventListener("click", async () => {
      try {
        const result = await auth.signInWithPopup(googleProvider);
        const user = result.user;
        joinEmailInput.value = user.email;

        Swal.fire({
          icon: "success",
          title: "Google Account Linked",
          text: `Signed in as ${user.email}`,
          timer: 2000,
          showConfirmButton: false,
        });
      } catch (error) {
        console.error("Google Sign-in Error:", error);
        Swal.fire({
          icon: "error",
          title: "Sign-in Failed",
          text: error.message,
        });
      }
    });

    // Join Form Submit
    document.getElementById("joinForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const joinEmail = joinEmailInput.value.trim().toLowerCase();
      const joinMessage = document.getElementById("join_message").value.trim();

      if (!joinEmail) {
        Swal.fire({
          icon: "warning",
          title: "Missing Email",
          text: "Please sign in with Google first by clicking the email box.",
        });
        return;
      }

      if (joinMessage.length > 200) {
        Swal.fire({
          icon: "warning",
          title: "Message Too Long",
          text: `Your message must not exceed 200 characters. (${joinMessage.length} entered)`,
        });
        return;
      }

      try {
        Swal.fire({
          title: "Submitting your request...",
          text: "Please wait a moment.",
          didOpen: () => Swal.showLoading(),
          allowOutsideClick: false,
        });

        await db.ref("join_requests").push({
          email: joinEmail,
          message: joinMessage,
          timestamp: new Date().toISOString(),
        });

        await emailjs.send("service_f4zsz1r", "template_re3enfm", {
          to_name: joinEmail,
          to_email: joinEmail,
        });

        Swal.fire({
          icon: "success",
          title: "Request Sent!",
          text: "Your request was submitted and a confirmation email has been sent.",
        });

        joinPopup.style.display = "none";
        document.getElementById("joinForm").reset();
      } catch (error) {
        console.error("Error:", error);
        Swal.fire({
          icon: "error",
          title: "Submission Failed",
          text: "There was an error submitting your request or sending confirmation.",
        });
      }
    });
  </script>

</body>
</html>
